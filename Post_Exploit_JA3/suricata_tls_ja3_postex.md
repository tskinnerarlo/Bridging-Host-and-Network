# Post Exploit JA3 Suricata rules
Below is a  Suricata ruleset that alerts on TLS JA3 hashes linked to common post-exploitation/C2 tools, plus why each rule works, how to deploy, and simple ways to test (pcap replay or a quick “plumbing” self-test).

I’ve used Suricata’s modern JA3 keywords (ja3.hash / ja3s.hash) and included a dataset-driven rule so you can maintain a list without editing rules every time. (JA3/JA4 keyword syntax and enablement are documented by OISF. 
[Suricata User Guide - https://docs.suricata.io/en/latest/rules/ja-keywords.html])

# Suricata rules (save as ```tls_ja3_postex.rules```)
Tweak the JA3 list as you like. All hashes are MD5 in lowercase.
These rules assume a typical egress direction: ```$HOME_NET → $EXTERNAL_NET```.
```suricata
###############################################################################
# JA3: Post-exploitation / C2 frameworks (client hellos)
# Notes:
#  - JA3 is not unique: expect collisions. Pairing with JA3S reduces FPs.
#  - Some frameworks randomize or can mimic browsers; use as hunting signals.
###############################################################################

# 220101 — Cobalt Strike common JA3 (client); seen widely in CS beacons
# Sources: DFIR/others report frequent CS use of 72a589da... (also used by other malware),
# and training material shows pairing with specific JA3S to reduce FPs. 
alert tls $HOME_NET any -> $EXTERNAL_NET any (
    msg:"TLS JA3: probable Cobalt Strike client (72a589da...)";
    flow:established,to_server;
    ja3.hash; content:"72a589da586844d7f0818ce684948eea";
    classtype:trojan-activity;
    reference:url:thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/;
    sid:220101; rev:1;
)

# 220102 — Cobalt Strike (JA3 + JA3S combo) for higher confidence
# Commonly reported combos (example JA3S shown below).
alert tls $HOME_NET any -> $EXTERNAL_NET any (
    msg:"TLS JA3+JA3S: probable Cobalt Strike (higher confidence)";
    flow:established,to_server;
    ja3.hash; content:"72a589da586844d7f0818ce684948eea";
    ja3s.hash; content:"b742b407517bac9536a77a7b0fee28e9";
    classtype:trojan-activity;
    reference:url:redsiege.com/wp-content/uploads/2021/09/20210914-SIEGECAST-COBALT-STRIKE-BASICS.pdf;
    sid:220102; rev:1;
)

# 220103 — Metasploit / Meterpreter (Linux example JA3 from Salesforce post)
alert tls $HOME_NET any -> $EXTERNAL_NET any (
    msg:"TLS JA3: Metasploit Meterpreter (Linux) (5d65ea3f...)";
    flow:established,to_server;
    ja3.hash; content:"5d65ea3fb1d4aa7d826733d2f2cbbb1d";
    classtype:trojan-activity;
    reference:url:engineering.salesforce.com/open-sourcing-ja3-92c9e53c3c41/;
    sid:220103; rev:1;
)

# 220104 — Metasploit combo: alternative client + JA3S
alert tls $HOME_NET any -> $EXTERNAL_NET any (
    msg:"TLS JA3+JA3S: probable Metasploit (a0e9f5d6... + 70999de6...)";
    flow:established,to_server;
    ja3.hash; content:"a0e9f5d64349fb13191bc781f81f42e1";
    ja3s.hash; content:"70999de61602be74d4b25185843bd18e";
    classtype:trojan-activity;
    reference:url:redsiege.com/wp-content/uploads/2021/09/20210914-SIEGECAST-COBALT-STRIKE-BASICS.pdf;
    sid:220104; rev:1;
)

# 220105 — Sliver C2 (Go TLS default style JA3 frequently reported in-the-wild)
alert tls $HOME_NET any -> $EXTERNAL_NET any (
    msg:"TLS JA3: Sliver (Go TLS) (19e29534...)";
    flow:established,to_server;
    ja3.hash; content:"19e29534fd49dd27d09234e639c4057e";
    classtype:trojan-activity;
    reference:url:darktrace.com/blog/sliver-c2-how-darktrace-provided-a-sliver-of-hope-in-the-face-of-an-emerging-c2-framework;
    sid:220105; rev:1;
)

# 220106 — Empire / PoshC2 (Python TLS stacks often show this JA3)
alert tls $HOME_NET any -> $EXTERNAL_NET any (
    msg:"TLS JA3: Python client often used by Empire/PoshC2 (db42e301...)";
    flow:established,to_server;
    ja3.hash; content:"db42e3017c8b6d160751ef3a04f695e7";
    classtype:trojan-activity;
    reference:url:thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/;
    sid:220106; rev:1;
)

###############################################################################
# 220110 — Dataset-driven rule (use Abuse.ch SSLBL/your own list)
# Keep a maintainable external list of JA3 md5 hashes (one per line).
# See deployment steps below to build/load 'postex-ja3.lst'.
###############################################################################
alert tls $HOME_NET any -> $EXTERNAL_NET any (
    msg:"TLS JA3: match in local dataset (post-ex/C2)";
    flow:established,to_server;
    ja3.hash; dataset:isset,postex-ja3, type md5, load postex-ja3.lst, memcap 10mb, hashsize 2048;
    classtype:trojan-activity;
    reference:url:sslbl.abuse.ch/ja3-fingerprints/;
    sid:220110; rev:1;
)
```
**Why these work**

- **JA3 matches the TLS ClientHello fingerprint** (cipher suites, extensions, etc.). Many C2 frameworks ship with characteristic TLS stacks or defaults, which produce stable JA3 hashes across campaigns—until the operator changes profiles or the tool randomizes. (Suricata JA3/JA4 rule syntax & enablement: ```ja3.hash```, ```ja3s.hash```, ```app-layer.protocols.tls.ja3-fingerprints: yes.```) 
[Suricata User Guide - https://docs.suricata.io/en/latest/rules/ja-keywords.html]

- Combining ```ja3.hash``` + ```ja3s.hash``` (server-side JA3S of the ServerHello) tightens confidence, as shown in blue-team training for Cobalt Strike and Metasploit. 
[redsiege.com - https://www.redsiege.com/wp-content/uploads/2021/09/20210914-SIEGECAST-COBALT-STRIKE-BASICS.pdf?]

- Specific post-ex/campaign examples for the hashes above are documented by DFIR Report, Darktrace, and Salesforce/JA3 posts. 
The DFIR Report [https://thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/]
Salesforce Engineering Blog[https://engineering.salesforce.com/tls-fingerprinting-with-ja3-and-ja3s-247362855967]
[redsiege.com - https://www.redsiege.com/wp-content/uploads/2021/09/20210914-SIEGECAST-COBALT-STRIKE-BASICS.pdf?]

- A dataset rule lets you maintain a living list (e.g., from abuse.ch SSLBL JA3 feed or your own intel). Suricata supports loading a list and checking any sticky buffer (here, ja3.hash) with dataset:isset. 
Suricata User Guide

⚠️ Reality check: JA3 ≠ attribution. Popular hashes collide with benign apps or other malware, and modern C2s can randomize/mimic browser stacks. Use these as hunting signals, not block-on-sight, unless combined with more context (JA3S, SNI, cert, flow behavior).