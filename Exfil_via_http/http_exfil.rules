###############################################################################
# Exfiltration via uncommon HTTP verbs (WebDAV/PUT/PATCH/etc.)
###############################################################################

# 200101 — Uncommon HTTP methods that often imply upload/write behavior
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"HTTP exfil: uncommon method with body (PUT/PATCH/PROPFIND/PROPPATCH/MKCOL/REPORT/SEARCH/TRACE/COPY/MOVE)";flow:established,to_server;http.method; pcre:"/^(?:PUT|PATCH|PROPFIND|PROPPATCH|MKCOL|REPORT|SEARCH|TRACE|COPY|MOVE)$/";http.header; content:"Content-Length:"; nocase;classtype:data-loss;metadata: created_at 2025_08_29, attack_target Server, mitre_technique_id T1041, mitre_technique_name "Exfiltration Over C2 Channel", mitre_technique_id T1567, mitre_technique_name "Exfiltration to Cloud Storage";threshold:type limit, track by_src, count 1, seconds 60;sid:200101; rev:1;)

###############################################################################
# Exfiltration via large POST bodies
###############################################################################

# 200102 — Large POST (>= ~1MB) by Content-Length (fast, header-only)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"HTTP exfil: large POST body (>= ~1MB)";flow:established,to_server;http.method; content:"POST";http.header; pcre:"/^\s*Content-Length:\s*(?:[1-9]\d{6,})/Hmi";classtype:data-loss;metadata: created_at 2025_08_29, attack_target Server, note "Header-based size check";threshold:type both, track by_src, count 1, seconds 120;sid:200102; rev:1;)

# 200103 — File upload via multipart/form-data (POST with filename=)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"HTTP exfil: POST multipart file upload (filename=)";flow:established,to_server;http.method; content:"POST";http.header; content:"Content-Type:"; nocase; content:"multipart/form-data"; nocase;http.request_body; content:"filename="; nocase;classtype:data-loss;metadata: created_at 2025_08_29, attack_target Server, note "Multipart upload with filename field";threshold:type limit, track by_src, count 2, seconds 120;sid:200103; rev:1;)

# 200104 — Bulk binary POST (octet-stream) with large body (~>=100 KB)
alert http $HOME_NET any -> $EXTERNAL_NET any (msg:"HTTP exfil: POST application/octet-stream (>= ~100KB)";flow:established,to_server;http.method; content:"POST";http.header; content:"Content-Type:"; nocase;content:"application/octet-stream"; nocase; pcre:"/^\s*Content-Length:\s*(?:[1-9]\d{5,})/Hmi";classtype:data-loss;metadata: created_at 2025_08_29, attack_target Server, note "Binary payload upload";threshold:type both, track by_src, count 1, seconds 120;sid:200104; rev:1;)
